<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在java/kotlin中使用UUID | NeroBlackstone&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.efb332ed.css" as="style"><link rel="preload" href="/assets/js/app.ec2d5af2.js" as="script"><link rel="preload" href="/assets/js/3.e9bff2d3.js" as="script"><link rel="preload" href="/assets/js/41.88d92bf1.js" as="script"><link rel="prefetch" href="/assets/js/10.7e730691.js"><link rel="prefetch" href="/assets/js/11.0a8c3a3b.js"><link rel="prefetch" href="/assets/js/12.e41009b6.js"><link rel="prefetch" href="/assets/js/13.615800ed.js"><link rel="prefetch" href="/assets/js/14.9ff2a10b.js"><link rel="prefetch" href="/assets/js/15.c0f3d8e0.js"><link rel="prefetch" href="/assets/js/16.267a81c0.js"><link rel="prefetch" href="/assets/js/17.85b26636.js"><link rel="prefetch" href="/assets/js/18.1172ae07.js"><link rel="prefetch" href="/assets/js/19.02da22ed.js"><link rel="prefetch" href="/assets/js/20.899cfc38.js"><link rel="prefetch" href="/assets/js/21.48a7b777.js"><link rel="prefetch" href="/assets/js/22.ae905edc.js"><link rel="prefetch" href="/assets/js/23.145304b2.js"><link rel="prefetch" href="/assets/js/24.fc9aa772.js"><link rel="prefetch" href="/assets/js/25.5370690c.js"><link rel="prefetch" href="/assets/js/26.4092c0ff.js"><link rel="prefetch" href="/assets/js/27.211a8f61.js"><link rel="prefetch" href="/assets/js/28.7b4de4b7.js"><link rel="prefetch" href="/assets/js/29.443848ae.js"><link rel="prefetch" href="/assets/js/30.8fb8f839.js"><link rel="prefetch" href="/assets/js/31.39c4255a.js"><link rel="prefetch" href="/assets/js/32.6e0fb50b.js"><link rel="prefetch" href="/assets/js/33.919f59b2.js"><link rel="prefetch" href="/assets/js/34.2fd50063.js"><link rel="prefetch" href="/assets/js/35.3dfac06e.js"><link rel="prefetch" href="/assets/js/36.a873c79a.js"><link rel="prefetch" href="/assets/js/37.85faec35.js"><link rel="prefetch" href="/assets/js/38.e83fe327.js"><link rel="prefetch" href="/assets/js/39.6be1856f.js"><link rel="prefetch" href="/assets/js/4.78206645.js"><link rel="prefetch" href="/assets/js/40.93ddf935.js"><link rel="prefetch" href="/assets/js/42.b3d6f88b.js"><link rel="prefetch" href="/assets/js/43.1c5dc4d4.js"><link rel="prefetch" href="/assets/js/44.195f887c.js"><link rel="prefetch" href="/assets/js/45.9aec365f.js"><link rel="prefetch" href="/assets/js/46.a1714c92.js"><link rel="prefetch" href="/assets/js/47.07f6e748.js"><link rel="prefetch" href="/assets/js/48.edfe58e7.js"><link rel="prefetch" href="/assets/js/5.290e8a5b.js"><link rel="prefetch" href="/assets/js/6.0be4f557.js"><link rel="prefetch" href="/assets/js/7.df8bc73d.js"><link rel="prefetch" href="/assets/js/8.9882d415.js"><link rel="prefetch" href="/assets/js/9.62493693.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.07834b74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.efb332ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><nav role="navigation" aria-label="main navigation" class="navbar is-primary is-fixed-top"><div class="navbar-brand"><a href="/" to="/" class="navbar-item router-link-active">
        NeroBlackstone's Blog
    </a><a role="button" aria-label="menu" class="navbar-burger burger"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu"><div class="navbar-start"></div><div class="navbar-end"><a href="/tag/" to="/tag/" class="navbar-item">Tag</a> <a href="/friends/" to="/friends/" class="navbar-item">Friends</a></div></div></nav> <section class="section"><div class="container"><div class="content__default"><h1 id="在java-kotlin中使用uuid"><a href="#在java-kotlin中使用uuid" class="header-anchor">#</a> 在java/kotlin中使用UUID</h1> <p>UUID(Universally Unique Identifier)，也被称为GUID（Globally Unique Identifier）代表了<strong>一个128位的值，具有唯一性。</strong> UUID使用十六进制数字（8字节）为标准表示：</p> <blockquote><p>123e4567-e89b-12d3-a456-556642440000</p></blockquote> <p>UUID由32个16进制数字与4个&quot;-&quot;符号组成，<strong>总共是36个字符。</strong> 而Nil UUID是UUID的特殊形式，所有位均为0。</p> <p>这篇文章将介绍如何在kotlin/java中使用UUID。</p> <h2 id="uuid结构"><a href="#uuid结构" class="header-anchor">#</a> UUID结构</h2> <p>先看一下这个示例UUID：</p> <div class="language- extra-class"><pre class="language-text"><code>123e4567-e89b-42d3-a456-556642440000
xxxxxxxx-xxxx-Bxxx-Axxx-xxxxxxxxxxxx
</code></pre></div><p>A代表了决定UUID布局的变体（variant）。UUID中的其他位取决于变量字段的比特位设置。变体由A的3个最高有效位（most significant bit，简称MBS，是指一个n位二进制数字中的n-1位）决定，（后跟13-15 bits 时钟序列） ：</p> <table><thead><tr><th>MSB1</th> <th>MSB2</th> <th>MSB3</th> <th></th></tr></thead> <tbody><tr><td>0</td> <td>X</td> <td>X</td> <td>reserved (0)</td></tr> <tr><td>1</td> <td>0</td> <td>X</td> <td>current variant (2)</td></tr> <tr><td>1</td> <td>1</td> <td>0</td> <td>reserved for Microsoft (6)</td></tr> <tr><td>1</td> <td>1</td> <td>1</td> <td>reserved for future (7)</td></tr></tbody></table> <p>上面UUID中A的值为'a'，二进制等效于1010，但是我们只需要取前面不同的两位也就是10xx，也就是变体为2。B的值代表版本。上面UUID的版本是4。</p> <p>java提供了取得UUID中变体和版本的方法：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> variant <span class="token operator">=</span> uuid<span class="token punctuation">.</span><span class="token function">variant</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> version <span class="token operator">=</span> uuid<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>变体2的UUID有5个不同的版本：基于时间生成的UUIDv1，基于DCE安全生成的UUIDv2，基于名称生成的UUIDv3和UUIDv5，随机生成的UUIDv4。</p> <p>Java提供了v3和v4的实现，但是也提供了用于生成任何类型UUID的构造函数。</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> uuid<span class="token operator">=</span><span class="token function">UUID</span><span class="token punctuation">(</span>mostSigBits<span class="token operator">:</span>Long<span class="token punctuation">,</span>leastSigBits<span class="token operator">:</span>Long<span class="token punctuation">)</span>
</code></pre></div><h2 id="版本3和版本5"><a href="#版本3和版本5" class="header-anchor">#</a> 版本3和版本5</h2> <p>UUID是使用命名空间和名称的哈希决定的。UUID的命名空间标识符（namespace identifiers）可以是诸如域名系统DNS，或是URL，还可以是对象标识符OIDs(Object Identifiers)。</p> <blockquote><p>UUID = hash(NAMESPACE_IDENTIFIER + NAME)</p></blockquote> <p>在UUIDv3和UUIDv5的唯一区别是哈希算法： v3使用MD5(128位)然而v5使用了SHA-1（160位）。</p> <p>简单来讲，这两个版本的UUID就是将哈希结果值截断为128位，然后替换掉4比特来表示版本，和2比特表示变体。</p> <p>下面的代码用于生成v3版本的UUID：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> source<span class="token operator">:</span> String <span class="token operator">=</span> namespace <span class="token operator">+</span> name
<span class="token keyword">val</span> bytes <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token function">charset</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">nameUUIDFromBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
</code></pre></div><p>注意java只提供了v3和v4的实现，v5没有提供。</p> <h2 id="版本4"><a href="#版本4" class="header-anchor">#</a> 版本4</h2> <p>UUIDv4的使用随机数字生成。java使用了SecureRandom来实现UUID生成，以不可用预测的值作为种子来产生随机数，以降低重复的可能性。下面是生成v4 UUID的方法：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>实践中，可以使用'SHA-256'和随机UUID来产生唯一的键值：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> salt <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;SHA-256&quot;</span><span class="token punctuation">)</span>
salt<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token function">charset</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//将byte array转为16进制字符串</span>
<span class="token comment">//X 表示以十六进制形式输出 02 表示不足两位,前面补0输出</span>
<span class="token keyword">val</span> digest <span class="token operator">=</span> salt<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinToString</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token string">&quot;%02x&quot;</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>UUIDv3和UUIDv5有一个非常好的特性：在相同的命名空间和相同的名称下，就可以生成相同的UUID。</p></div> <!----></div></section> <footer class="footer" data-v-29777868><div class="level" data-v-29777868><div class="content level-item has-text-centered" data-v-29777868><div class="field is-grouped-multiline is-grouped" data-v-29777868><!----> <div class="control" data-v-29777868><span class="tag is-primary" data-v-29777868><span><a href="https://github.com/NeroBlackstone" class="has-text-white" data-v-29777868><span class="icon" data-v-29777868><i class="fab fa-github" data-v-29777868></i></span></a></span> <!----></span></div> <div class="control" data-v-29777868><a href="https://v1.vuepress.vuejs.org/" data-v-29777868><div class="tags has-addons" data-v-29777868><span class="tag is-dark" data-v-29777868><span>vuepress</span> <!----></span> <span class="tag is-info" data-v-29777868><span>1.5.0</span> <!----></span></div></a></div><div class="control" data-v-29777868><a href="https://buefy.org/" data-v-29777868><div class="tags has-addons" data-v-29777868><span class="tag is-dark" data-v-29777868><span>buefy</span> <!----></span> <span class="tag is-info" data-v-29777868><span>0.8.20</span> <!----></span></div></a></div> <!----></div></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ec2d5af2.js" defer></script><script src="/assets/js/3.e9bff2d3.js" defer></script><script src="/assets/js/41.88d92bf1.js" defer></script>
  </body>
</html>
