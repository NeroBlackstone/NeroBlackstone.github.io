<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM GC 回顾 | NeroBlackstone&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.efb332ed.css" as="style"><link rel="preload" href="/assets/js/app.ec2d5af2.js" as="script"><link rel="preload" href="/assets/js/3.e9bff2d3.js" as="script"><link rel="preload" href="/assets/js/25.5370690c.js" as="script"><link rel="prefetch" href="/assets/js/10.7e730691.js"><link rel="prefetch" href="/assets/js/11.0a8c3a3b.js"><link rel="prefetch" href="/assets/js/12.e41009b6.js"><link rel="prefetch" href="/assets/js/13.615800ed.js"><link rel="prefetch" href="/assets/js/14.9ff2a10b.js"><link rel="prefetch" href="/assets/js/15.c0f3d8e0.js"><link rel="prefetch" href="/assets/js/16.267a81c0.js"><link rel="prefetch" href="/assets/js/17.85b26636.js"><link rel="prefetch" href="/assets/js/18.1172ae07.js"><link rel="prefetch" href="/assets/js/19.02da22ed.js"><link rel="prefetch" href="/assets/js/20.899cfc38.js"><link rel="prefetch" href="/assets/js/21.48a7b777.js"><link rel="prefetch" href="/assets/js/22.ae905edc.js"><link rel="prefetch" href="/assets/js/23.145304b2.js"><link rel="prefetch" href="/assets/js/24.fc9aa772.js"><link rel="prefetch" href="/assets/js/26.4092c0ff.js"><link rel="prefetch" href="/assets/js/27.211a8f61.js"><link rel="prefetch" href="/assets/js/28.7b4de4b7.js"><link rel="prefetch" href="/assets/js/29.443848ae.js"><link rel="prefetch" href="/assets/js/30.8fb8f839.js"><link rel="prefetch" href="/assets/js/31.39c4255a.js"><link rel="prefetch" href="/assets/js/32.6e0fb50b.js"><link rel="prefetch" href="/assets/js/33.919f59b2.js"><link rel="prefetch" href="/assets/js/34.2fd50063.js"><link rel="prefetch" href="/assets/js/35.3dfac06e.js"><link rel="prefetch" href="/assets/js/36.a873c79a.js"><link rel="prefetch" href="/assets/js/37.85faec35.js"><link rel="prefetch" href="/assets/js/38.e83fe327.js"><link rel="prefetch" href="/assets/js/39.6be1856f.js"><link rel="prefetch" href="/assets/js/4.78206645.js"><link rel="prefetch" href="/assets/js/40.93ddf935.js"><link rel="prefetch" href="/assets/js/41.88d92bf1.js"><link rel="prefetch" href="/assets/js/42.b3d6f88b.js"><link rel="prefetch" href="/assets/js/43.1c5dc4d4.js"><link rel="prefetch" href="/assets/js/44.195f887c.js"><link rel="prefetch" href="/assets/js/45.9aec365f.js"><link rel="prefetch" href="/assets/js/46.a1714c92.js"><link rel="prefetch" href="/assets/js/47.07f6e748.js"><link rel="prefetch" href="/assets/js/48.edfe58e7.js"><link rel="prefetch" href="/assets/js/5.290e8a5b.js"><link rel="prefetch" href="/assets/js/6.0be4f557.js"><link rel="prefetch" href="/assets/js/7.df8bc73d.js"><link rel="prefetch" href="/assets/js/8.9882d415.js"><link rel="prefetch" href="/assets/js/9.62493693.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.07834b74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.efb332ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><nav role="navigation" aria-label="main navigation" class="navbar is-primary is-fixed-top"><div class="navbar-brand"><a href="/" to="/" class="navbar-item router-link-active">
        NeroBlackstone's Blog
    </a><a role="button" aria-label="menu" class="navbar-burger burger"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu"><div class="navbar-start"></div><div class="navbar-end"><a href="/tag/" to="/tag/" class="navbar-item">Tag</a> <a href="/friends/" to="/friends/" class="navbar-item">Friends</a></div></div></nav> <section class="section"><div class="container"><div class="content__default"><h1 id="jvm-gc-回顾"><a href="#jvm-gc-回顾" class="header-anchor">#</a> JVM GC 回顾</h1> <p>因为历史原因，Java GC已经有几代的实现，本文回顾java 11 ZGC之前的GC实现。</p> <h2 id="什么是gc（garbage-collection）"><a href="#什么是gc（garbage-collection）" class="header-anchor">#</a> 什么是GC（Garbage Collection）</h2> <p>从名字上看，GC是从内存中寻找并删除垃圾的过程，但实际上GC会追踪JVM heap中每一个对象，并删掉无用对象回收内存。</p> <p>简单来讲，GC由Mark和Sweep两个简单步骤实现。</p> <ul><li>Mark 这个步骤垃圾收集器标记一块内存是否在被使用</li> <li>Sweep 这个步骤移除了被标记的对象</li></ul> <p>jvm这样实现GC有着哪些优点和缺点呢？</p> <p>优点：</p> <ul><li>不需要手动分配内存/取消分配内存，因为内存空间就是由GC自动管理的</li> <li>不会有处理野指针（Dangling Pointer）的开销</li></ul> <blockquote><p>在计算机编程领域中，迷途指针，或称悬空指针、野指针，指的是不指向任何合法的对象的指针。----wikipedia</p></blockquote> <ul><li>可自动管理内存泄露(GC本身并非内存泄露的完整解决方案，但是它可以解决大部分问题)</li></ul> <blockquote><p>在计算机科学中，内存泄漏指由于疏忽或错误造成程序未能释放已经不再使用的内存。----wikipedia</p></blockquote> <p>缺点：</p> <ul><li>由于JVM必须持续追踪对象的创建/删除，因此相较于程序本身需要更多的CPU性能。这可能会影响需要极大内存的程序的性能。</li> <li>程序员没有办法去控制“释放不再需要的对象”这部分的cpu时间调度。</li> <li>使用某些GC实现也许会导致程序意外崩溃。</li> <li>自动化的内存管理不如手动管理有效率（毕竟需要算法去判断）</li></ul> <h2 id="gc实现"><a href="#gc实现" class="header-anchor">#</a> GC实现</h2> <p>在java11之前，JVM曾有四种GC实现：</p> <ul><li>Serial Garbage Collector</li> <li>Parallel Garbage Collector</li> <li>CMS Garbage Collector</li> <li>G1 Garbage Collector</li></ul> <h3 id="serial-gc"><a href="#serial-gc" class="header-anchor">#</a> Serial GC</h3> <p>Serial GC是最简单的GC实现，因为它基本上可以在<strong>单线程</strong> 上工作。但是这个GC实现会在GC运行时冻结所有的应用程序线程。<strong>因此，它不适合在服务器等多线程应用中使用。</strong></p> <p>Serial GC对<strong>大多有大块暂停时间的应用（比如各种客户端）</strong> 比较适合。要启用Serial GC，需要下列参数：</p> <blockquote><p>java -XX:+UseSerialGC -jar Application.java</p></blockquote> <h3 id="parallel-gc"><a href="#parallel-gc" class="header-anchor">#</a> Parallel GC</h3> <p>Parallel GC是JVM默认的的GC，也被称为Throughput GC。不像串行垃圾收集器，Parallel使用多线程来管理heap空间。但是它在执行GC的过程中依然会暂停其他应用程序线程。</p> <p>如果使用这个GC，我们可以详细的指定GC线程数量（threads）和暂停时间（pause time），吞吐量（throughput）和占用空间（footprint）（堆大小）</p> <ul><li><p>垃圾收集器线程的数量可以由命令行<code>-XX:ParallelGCThreads=&lt;N&gt;</code>控制</p></li> <li><p>最大暂停时间（两次GC间隔时间，毫秒计算）可由命令行 <code>-XX:MaxGCPauseMillis=&lt;N&gt;</code>控制</p></li> <li><p>最大吞吐量（衡量花费在垃圾收集上的时间和之外的时间）由命令行<code>XX:GCTimeRatio=&lt;N&gt;</code>控制</p></li> <li><p>最大堆占用空间（程序运行时所需的最大堆内存量）由命令行<code>-Xmx&lt;N&gt;</code>控制</p></li></ul> <p>要开启Parallel GC，使用下列参数:</p> <blockquote><p>java -XX:+UseParallelGC -jar Application.java</p></blockquote> <h3 id="cms-gc"><a href="#cms-gc" class="header-anchor">#</a> CMS GC</h3> <p>Concurrent Mark Sweep（CMS）GC使用多个垃圾回收线程做垃圾回收。它是为更短的垃圾回收暂停时间而设计，并且程序运行时可以和垃圾回收器共享处理器资源。</p> <p>简而言之，采用此类GC的程序平均响应更慢，但是不会在执行GC时暂停响应。</p> <p>需要注意的是，由于GC是并发的，如果并发操作正在运行，这时显式调用像System.gc()的垃圾回收，会导致并发模式失败（Concurrent Mode Failure）。</p> <p>如果超过98%的时间用于CMS GC且少于2%的时间回收堆，CMS收集器将会抛出<code>OutOfMemoryError</code>。如有必要，可以通过命令行<code>XX：-UseGCOverheadLimit</code>来禁用这个功能。</p> <p>要启用CMS垃圾收集器，可以使用下列命令：</p> <blockquote><p>java -XX:+UseParNewGC -jar Application.java</p></blockquote> <h3 id="g1-gc"><a href="#g1-gc" class="header-anchor">#</a> G1 GC</h3> <p>G1（Garbage First） GC被设计用于面向运行在多核处理器上且有极大内存空间的程序。G1是取代CMS的下一代收集器，因为它有更高的性能效率。</p> <p>不像其他收集器，G1收集器会将堆划分为一组大小相等的堆区域，每个堆区域都是一块连续的虚拟内存。当执行GC时，G1进入一个并发全局标记阶段（阶段1：Marking），以确定整个堆中对象的存活性。</p> <p>Mark阶段完成后，G1会了解哪块区域大部分应该被清空。G1首先回收这些区域的内存，这样可以达到快速回收大量可用内存的目的(阶段2：Sweeping)。这就是为什么这种GC方法被称为Garbage-First。</p> <p>开启G1 GC，可以使用下面的参数：</p> <blockquote><p>java -XX:+UseG1GC -jar Application.java</p></blockquote></div> <!----></div></section> <footer class="footer" data-v-29777868><div class="level" data-v-29777868><div class="content level-item has-text-centered" data-v-29777868><div class="field is-grouped-multiline is-grouped" data-v-29777868><!----> <div class="control" data-v-29777868><span class="tag is-primary" data-v-29777868><span><a href="https://github.com/NeroBlackstone" class="has-text-white" data-v-29777868><span class="icon" data-v-29777868><i class="fab fa-github" data-v-29777868></i></span></a></span> <!----></span></div> <div class="control" data-v-29777868><a href="https://v1.vuepress.vuejs.org/" data-v-29777868><div class="tags has-addons" data-v-29777868><span class="tag is-dark" data-v-29777868><span>vuepress</span> <!----></span> <span class="tag is-info" data-v-29777868><span>1.5.0</span> <!----></span></div></a></div><div class="control" data-v-29777868><a href="https://buefy.org/" data-v-29777868><div class="tags has-addons" data-v-29777868><span class="tag is-dark" data-v-29777868><span>buefy</span> <!----></span> <span class="tag is-info" data-v-29777868><span>0.8.20</span> <!----></span></div></a></div> <!----></div></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ec2d5af2.js" defer></script><script src="/assets/js/3.e9bff2d3.js" defer></script><script src="/assets/js/25.5370690c.js" defer></script>
  </body>
</html>
