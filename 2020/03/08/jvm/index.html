<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jvm笔记 | NeroBlackstone&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.efb332ed.css" as="style"><link rel="preload" href="/assets/js/app.ec2d5af2.js" as="script"><link rel="preload" href="/assets/js/3.e9bff2d3.js" as="script"><link rel="preload" href="/assets/js/10.7e730691.js" as="script"><link rel="prefetch" href="/assets/js/11.0a8c3a3b.js"><link rel="prefetch" href="/assets/js/12.e41009b6.js"><link rel="prefetch" href="/assets/js/13.615800ed.js"><link rel="prefetch" href="/assets/js/14.9ff2a10b.js"><link rel="prefetch" href="/assets/js/15.c0f3d8e0.js"><link rel="prefetch" href="/assets/js/16.267a81c0.js"><link rel="prefetch" href="/assets/js/17.85b26636.js"><link rel="prefetch" href="/assets/js/18.1172ae07.js"><link rel="prefetch" href="/assets/js/19.02da22ed.js"><link rel="prefetch" href="/assets/js/20.899cfc38.js"><link rel="prefetch" href="/assets/js/21.48a7b777.js"><link rel="prefetch" href="/assets/js/22.ae905edc.js"><link rel="prefetch" href="/assets/js/23.145304b2.js"><link rel="prefetch" href="/assets/js/24.fc9aa772.js"><link rel="prefetch" href="/assets/js/25.5370690c.js"><link rel="prefetch" href="/assets/js/26.4092c0ff.js"><link rel="prefetch" href="/assets/js/27.211a8f61.js"><link rel="prefetch" href="/assets/js/28.7b4de4b7.js"><link rel="prefetch" href="/assets/js/29.443848ae.js"><link rel="prefetch" href="/assets/js/30.8fb8f839.js"><link rel="prefetch" href="/assets/js/31.39c4255a.js"><link rel="prefetch" href="/assets/js/32.6e0fb50b.js"><link rel="prefetch" href="/assets/js/33.919f59b2.js"><link rel="prefetch" href="/assets/js/34.2fd50063.js"><link rel="prefetch" href="/assets/js/35.3dfac06e.js"><link rel="prefetch" href="/assets/js/36.a873c79a.js"><link rel="prefetch" href="/assets/js/37.85faec35.js"><link rel="prefetch" href="/assets/js/38.e83fe327.js"><link rel="prefetch" href="/assets/js/39.6be1856f.js"><link rel="prefetch" href="/assets/js/4.78206645.js"><link rel="prefetch" href="/assets/js/40.93ddf935.js"><link rel="prefetch" href="/assets/js/41.88d92bf1.js"><link rel="prefetch" href="/assets/js/42.b3d6f88b.js"><link rel="prefetch" href="/assets/js/43.1c5dc4d4.js"><link rel="prefetch" href="/assets/js/44.195f887c.js"><link rel="prefetch" href="/assets/js/45.9aec365f.js"><link rel="prefetch" href="/assets/js/46.a1714c92.js"><link rel="prefetch" href="/assets/js/47.07f6e748.js"><link rel="prefetch" href="/assets/js/48.edfe58e7.js"><link rel="prefetch" href="/assets/js/5.290e8a5b.js"><link rel="prefetch" href="/assets/js/6.0be4f557.js"><link rel="prefetch" href="/assets/js/7.df8bc73d.js"><link rel="prefetch" href="/assets/js/8.9882d415.js"><link rel="prefetch" href="/assets/js/9.62493693.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.07834b74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.efb332ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><nav role="navigation" aria-label="main navigation" class="navbar is-primary is-fixed-top"><div class="navbar-brand"><a href="/" to="/" class="navbar-item router-link-active">
        NeroBlackstone's Blog
    </a><a role="button" aria-label="menu" class="navbar-burger burger"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu"><div class="navbar-start"></div><div class="navbar-end"><a href="/tag/" to="/tag/" class="navbar-item">Tag</a> <a href="/friends/" to="/friends/" class="navbar-item">Friends</a></div></div></nav> <section class="section"><div class="container"><div class="content__default"><h1 id="jvm笔记"><a href="#jvm笔记" class="header-anchor">#</a> jvm笔记</h1> <p>jvm运行在操作系统上，它与硬件没有直接交互。</p> <p>java中负责对字节代码解释执行的是虚拟机。</p> <p>体系结构：</p> <p><img src="/assets/img/jvm.352980fe.png" alt="JVM"></p> <h2 id="类加载器-class-loader"><a href="#类加载器-class-loader" class="header-anchor">#</a> 类加载器/Class Loader</h2> <p>负责加载class文件，class文件在文件开头有特定的文件标示。并且ClassLoader只负责class文件的加载，至于它是否可以运行，则由Execution Engine决定。</p> <p><img src="/assets/img/ClassLoader.75a3b54c.png" alt="ClassLoader"></p> <h3 id="虚拟机自带的加载器"><a href="#虚拟机自带的加载器" class="header-anchor">#</a> 虚拟机自带的加载器</h3> <ul><li>启动类加载器：BootstrapClassLoader （cpp实现）</li> <li>平台类加载器：PlatformClassLoader （java实现）</li> <li>应用类加载器：AppClassLoader （java实现，也叫做“系统类加载器”）</li></ul> <p>启动类加载器，负责加载JVM虚拟机运行时所需的基本系统级别的类，如java.lang.String, java.lang.Object等等。启动类加载器无法通过<code>any.javaClass.classLoader</code>的方式取得。（因为它不是java实现的）</p> <p>平台类加载器之前叫Extension Class Loader，但是java 9 之后为了支持模块系统，扩展机制被删除。</p> <p>在java 9 之后，运行下列代码：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> MyClass

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> myClass<span class="token operator">=</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span>myClass<span class="token punctuation">.</span>javaClass<span class="token punctuation">.</span>classLoader<span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span>myClass<span class="token punctuation">.</span>javaClass<span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>parent<span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span>myClass<span class="token punctuation">.</span>javaClass<span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>会打印:</p> <div class="language- extra-class"><pre class="language-text"><code>jdk.internal.loader.ClassLoaders$AppClassLoader@42a57993
jdk.internal.loader.ClassLoaders$PlatformClassLoader@eed1f14
null
</code></pre></div><h4 id="双亲委派"><a href="#双亲委派" class="header-anchor">#</a> 双亲委派</h4> <p>双亲委派模型工作过程：一个类加载器收到类加载的请求，它首先会把这个请求委派给父类加载器去完成，层层上升，只有当父类加载器无法完成此加载请求时，子加载器才会尝试自己去加载。</p> <p>要注意的是父加载器和子加载器的关系不是继承关系而是组合关系。子加载器中有一个私有属性 parent 指向父加载器。</p> <h4 id="沙箱机制"><a href="#沙箱机制" class="header-anchor">#</a> 沙箱机制</h4> <p>沙箱安全机制是由基于双亲委派机制上，采取的一种JVM的自我保护机制,假设自己写一个java.lang.String 的类,在类中自定义方法，由于双亲委派机制的原理,此请求会先交给Bootstrap试图进行加载,但是Bootstrap在加载类时首先通过包和类名查找rt.jar中有没有该类,有则优先加载rt.jar包中的类,没有自定义方法会报错，因此就保证了java的运行机制不会被破坏。</p> <h3 id="用户自定义的加载器"><a href="#用户自定义的加载器" class="header-anchor">#</a> 用户自定义的加载器</h3> <p>java.lang.ClassLoader的子类，用户可以自定义类的加载方式。</p> <h2 id="执行引擎-execution-engine"><a href="#执行引擎-execution-engine" class="header-anchor">#</a> 执行引擎 / Execution Engine</h2> <p>Execution Engine负责解释命令，提交给操作系统执行。</p> <h2 id="本地接口-java-native-interface-jni"><a href="#本地接口-java-native-interface-jni" class="header-anchor">#</a> 本地接口 / java native interface / JNI</h2> <p>用于调用c/cpp方法</p> <h2 id="本地方法栈-native-method-stack"><a href="#本地方法栈-native-method-stack" class="header-anchor">#</a> 本地方法栈 / Native Method Stack</h2> <p>Native Method Stack中登记native method，Execution Engine执行时加载本地方法库。</p> <h2 id="程序计数寄存器-program-counter-register"><a href="#程序计数寄存器-program-counter-register" class="header-anchor">#</a> 程序计数寄存器 / Program Counter Register</h2> <p>每个线程都有一个程序计数器。是线程私有的，就是一个指针，指向方法区的方法字节码（用来存储指向下一条指令的地址），由执行引擎读取下一条指令，是一个非常小的内存空间，几乎可以忽略不计。</p> <h2 id="方法区-method-area"><a href="#方法区-method-area" class="header-anchor">#</a> 方法区 / Method Area</h2> <p>方法区被所有线程共享，所有字段和方法字节码，以及一些特定的方法如构造函数，接口也在此定义。所有定义的方法的信息都保存在该区域，<strong>此区属于共享空间</strong>。</p> <p>静态变量+常量+类信息（构造方法/接口定义）+运行时常量池存在方法区中。</p> <p>但是实例变量存在堆内存中，和方法区无关。</p></div> <!----></div></section> <footer class="footer" data-v-29777868><div class="level" data-v-29777868><div class="content level-item has-text-centered" data-v-29777868><div class="field is-grouped-multiline is-grouped" data-v-29777868><!----> <div class="control" data-v-29777868><span class="tag is-primary" data-v-29777868><span><a href="https://github.com/NeroBlackstone" class="has-text-white" data-v-29777868><span class="icon" data-v-29777868><i class="fab fa-github" data-v-29777868></i></span></a></span> <!----></span></div> <div class="control" data-v-29777868><a href="https://v1.vuepress.vuejs.org/" data-v-29777868><div class="tags has-addons" data-v-29777868><span class="tag is-dark" data-v-29777868><span>vuepress</span> <!----></span> <span class="tag is-info" data-v-29777868><span>1.5.0</span> <!----></span></div></a></div><div class="control" data-v-29777868><a href="https://buefy.org/" data-v-29777868><div class="tags has-addons" data-v-29777868><span class="tag is-dark" data-v-29777868><span>buefy</span> <!----></span> <span class="tag is-info" data-v-29777868><span>0.8.20</span> <!----></span></div></a></div> <!----></div></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ec2d5af2.js" defer></script><script src="/assets/js/3.e9bff2d3.js" defer></script><script src="/assets/js/10.7e730691.js" defer></script>
  </body>
</html>
